"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},__assign.apply(this,arguments)};function encodeServerKey(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),r=window.atob(e),i=new Uint8Array(r.length),n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return i}function required(t){throw void 0===t&&(t=""),new Error("Missing parameter "+t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebPushClientFactory=exports.WebPushClient=void 0;var WebPushUtils={checkPermission:function(){return Notification.requestPermission()},registerServiceWorker:function(t){return navigator.serviceWorker.register(t).then((function(t){return t}))},getSubscription:function(t){return t.pushManager.getSubscription()}},RemoteStorage=function(){function t(t){this.url=t,this.url=t}return t.prototype.register=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),fetch(this.url,{method:"POST",mode:"cors",credentials:"include",cache:"default",headers:new Headers(__assign({Accept:"application/json","Content-Type":"application/json"},r)),body:JSON.stringify({subscription:t,options:e})}).then((function(){return t}))},t.prototype.updateOptions=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),fetch(this.url,{method:"PUT",mode:"cors",credentials:"include",cache:"default",headers:new Headers(__assign({Accept:"application/json","Content-Type":"application/json"},r)),body:JSON.stringify({subscription:t,options:e})}).then((function(){return t}))},t.prototype.unregister=function(t,e){return void 0===e&&(e={}),fetch(this.url,{method:"DELETE",mode:"cors",credentials:"include",cache:"default",headers:new Headers(__assign({Accept:"application/json","Content-Type":"application/json"},e)),body:JSON.stringify({subscription:t})}).then((function(){return!0}))},t.prototype.ping=function(t,e){return void 0===e&&(e={}),fetch(this.url,{method:"PING",mode:"cors",credentials:"include",cache:"default",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),body:JSON.stringify({subscription:t,options:e})}).then((function(){return!0}))},t}(),PushNotificationsNotSupported=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Error),CreateClientError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Error),WebPushClient=function(){function t(t){var e=t.isSupported,r=t.permissionStatus,i=t.serviceWorkerRegistration,n=t.subscription,o=t.applicationServerKey,s=t.subscribeUrl;this.supported=e,this.permissionStatus=r,this.registration=i,this.applicationServerKey=o,this.subscription=n,this.storage=void 0!==s?new RemoteStorage(s):null}return t.prototype.isSupported=function(){return this.supported},t.prototype.ensureSupported=function(){if(!this.isSupported())throw Error("This browser does not support push notifications.")},t.prototype.ensureUrlIsProvided=function(){if(!this.storage)throw Error("Webpush client error: subscribeUrl has not been provided.");return!0},t.prototype.isUrlProvided=function(){return!!this.storage},t.prototype.getPermissionState=function(){return this.ensureSupported(),this.permissionStatus},t.prototype.getSubscription=function(){return this.subscription},t.prototype.subscribe=function(t,e,r){var i=this;return void 0===t&&(t={}),void 0===e&&(e=this.isUrlProvided()),void 0===r&&(r={}),this.ensureSupported(),this.registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.applicationServerKey}).then((function(n){return i.subscription=n,!0===e&&i.ensureUrlIsProvided()&&i.storage?i.storage.register(n,t,r):new Promise((function(t){return t(PushSubscription)}))}))},t.prototype.unsubscribe=function(t,e){var r=this;return void 0===t&&(t=this.isUrlProvided()),void 0===e&&(e={}),this.ensureSupported(),WebPushUtils.getSubscription(this.registration).then((function(i){i&&i.unsubscribe().then((function(){return r.subscription=null,!0===t&&r.ensureUrlIsProvided()&&r.storage?r.storage.unregister(i,e):new Promise((function(t){return t(!0)}))}))}))},t.prototype.updateOptions=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e={}),this.ensureSupported(),this.ensureUrlIsProvided(),this.storage&&this.subscription)return this.storage.updateOptions(this.subscription,t,e)},t.prototype.ping=function(t){if(void 0===t&&(t={}),this.ensureSupported(),this.ensureUrlIsProvided(),this.storage&&this.subscription)return this.storage.ping(this.subscription,t)},t}();exports.WebPushClient=WebPushClient,exports.WebPushClientFactory={isSupported:function(){return"PushManager"in window&&"fetch"in window&&"permissions"in navigator&&"serviceWorker"in navigator},create:function(t){var e=t.serviceWorkerPath,r=t.subscribeUrl,i=t.serverKey;if(!this.isSupported())throw new PushNotificationsNotSupported;return WebPushUtils.checkPermission().then((function(t){return WebPushUtils.registerServiceWorker(e).then((function(e){return WebPushUtils.getSubscription(e).then((function(n){return new WebPushClient({isSupported:!0,applicationServerKey:encodeServerKey(i),permissionStatus:t,serviceWorkerRegistration:e,subscription:n,subscribeUrl:r})}))})).catch((function(t){throw console.warn("Webpush client cannot be started: "+t),new CreateClientError(t.message)}))}))}};